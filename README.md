# A4AV_quiz_bot v0.2
#### Телеграм-бот, создающий список квизов которые проходят в Новосибирске.
* Умеет фильтровать информацию по удобным дням недели, тематикам игр и организаторам.
* Может исключать заведомо неподходящие места проведения, неинтересные тематики и нелюбимых организаторов.
Например, автору неудобно ездить в бары Академгородка и уже не по рангу играть в квизы для новичков.
* Формирует голосование для определения количества игроков, желающих пойти на игру. Удобно переслать его в ваш
командный чат.

Берет информацию с сайтов следующих организаторов:
* [Квиз Плиз](https://nsk.quizplease.ru/schedule)
* [Лига Индиго](https://ligaindigo.ru/novosibirsk)
* [Шейкер Квиз](https://novosibirsk.shakerquiz.ru/)
* [Эйнштейн пати](https://nsk.albertparty.ru/schedule)
* [WOW Quiz](https://nsk.wowquiz.ru/)


Также в городе проводят квизы и другие интересные организаторы:
* [СибКвиз](https://vk.com/sibquiz)
* [ТимПати](https://vk.com/teampartynsk)
* [Угадай мелодию](https://vk.com/um_nsk)
* [QuizClub](https://vk.com/quizclubnsk)

К сожалению у них нет своих сайтов со структурированным расписанием, поэтому бот пока не умеет собирать информацию
по их играм.

### Логика работы бота
> [!NOTE] 
> Предполагается использование бота в индивидуальных чатах (пользователь-бот). 
> 
> Работоспособность в групповых чатах ограничена.


Бот запускается по команде **/start**.

Осуществляется проверка наличия информации о предпочтениях пользователя в базе данных. В предпочтениях пользователь 
указывает какие бары, тематики и организаторы ему не интересны и они перманентно исключаются из отфильтрованного списка 
квизов.

Пользователю предлагается выбрать день недели (будни/ выходные/ любой) в который он хотел бы сходить на квиз.

Затем пользователю предлагается выбрать интересующую его тематику квиза из всех возможных тематик (за исключением тех, 
которые пользователю неинтересны).

На основании ответов пользователя, а также его предпочтений формируется отфильтрованный список квизов.

Также в любой момент пользователь может отправить команду **/all** для получения полного списка квизов. 
В него попадут все возможные квизы, за исключением тех на которые уже нет мест или на которые требуется приглашение 
организатора.

В ответ на полученный список квизов пользователь может отправить порядковый номер квиза из списка и бот сформирует 
опрос, предназначенный для определения количества игроков, желающих поучастовать в этом квизе.

Чтобы обновить свои настройки пользователь может отправить команду **/preferences**. Она выведет пользователю его 
текущие настройки и спросит хочет ли он их изменить. Если пользователь хочет изменить настройки, то бот поэтапно 
задаст вопросы какие бары, тематики, организаторы должны быть исключены из выборки.

Пользователь также в любой момент может завершить работу командой **/bye**.

### Создание собственного бота
1. Создайте [бота в Telegram](https://core.telegram.org/bots/features#creating-a-new-bot)

2. Получите его [токен](https://core.telegram.org/bots/tutorial#obtain-your-bot-token)

3. Создайте в вашем боте следующие [команды](https://core.telegram.org/bots/tutorial#executing-commands):

- start - запустить бота

- all - полный список квизов

- settings - настройки пользователя

- bye - выключить бота

### Установка
На вашем компьютере должны быть установлены следующие программы:
- [Python 3.10+](https://www.python.org/downloads/)
- [pip](https://pip.pypa.io/en/stable/installation/)
- [git](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git)
- [Google Chrome](https://www.google.com/chrome/)
- [ChromeDriver версии совместимой с вашим Google Chrome](https://chromedriver.chromium.org/downloads)
<br></br>[Хорошая статья по установке Chrome и ChromeDriver на Ubuntu](https://skolo.online/documents/webscrapping/)

1. Скопируйте исходный код проекта с github:
```
git clone https://github.com/vdolgov91/A4AV_quiz_bot.git
```

2. Перейдите в корневую папку проекта:
```
cd A4AV_quiz_bot
```

3. Создайте в проекте виртуальное окружение (virtual environment):

Linux: `python3 -m venv venv`

Windows: `python -m venv venv`

4. Активируйте созданный virtual environment:

Linux: `source venv/bin/activate`

Windows: `venv\Scripts\activate`

5. Установите в virtual environment проекта все необходимые зависимости: 
```
pip install -r requirements.txt
```

Подробнее о virtual environments и установке модулей с помощью pip в официальной 
[документации](https://packaging.python.org/en/latest/guides/installing-using-pip-and-virtual-environments/) .

6. С помощью текстового редактора или IDE создайте Python-модуль `src/secrets.py` с указание токена подключения к боту:
```python
BOT_TOKEN = 'your-telegram-bot-token'
```

7. Перейдите в папку `src`, чтобы файл базы данных SQLite был создан по корректному относительному пути: 
`A4AV_quiz_bot/app_db/`
```
cd ./src
```

8. Запустите бот из папки `src` с помощью командой строки или из интерфейса IDE:

Linux: `python3 telegramBot.py`

Windows: `python telegramBot.py`

### Тестирование
Модули `dbOperations.py` и `quizAggregator.py` частично покрыты unit-тестами с помощью **pytest** (на апрель 2025 не
покрыты тестами функция scrape_wow_quiz() и scrape_einstein_party() после того как изменился дизайн сайта WOW Quiz.
Модуль `telegramBot.py` на настоящее время не покрыт тест-кейстами.

Для запуска тестов в корневой папке проекта выполните команду `pytest`.
